<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8"/>
			<link rel="stylesheet", href="/stylesheets/style.css" />
			<!-- Load the Paper.js library -->
			<script type="text/javascript" src="Paper/docs/assets/js/paper.js"></script>
			<!-- Define inlined PaperScript associate it with myCanvas -->
			<script type="text/paperscript" canvas="myCanvas">
	
var ws = new WebSocket("wss://localhost:4710/");

var radius = 30;
var path = new Path.Circle(new Point(500, 300), radius);
path.fillColor = 'black';

var path1 = new Path.Circle(new Point(500, 200), radius);
var path2 = new Path.Circle(new Point(500, 200), radius);
var path3 = new Path.Circle(new Point(500, 200), radius);

var candy = new Path.Circle(new Point(100, 100), radius);
candy.fillColor = 'red';

var elem = [];
elem.push(path1, path2, path3);

// connexion au serveur
ws.onopen = function (event) 
{
  	console.log("I'm here");
};


// envoi click au serveur
function onMouseUp(event) 
{
	var pt = new Point(event.point);
	var message = { 
				type : "clic",
				posx : pt.x,
				posy : pt.y
		};
		ws.send(JSON.stringify(message));
}


//Reception de message
ws.onmessage = function (message) 
{ 
	var msg = JSON.parse(message.data);

	
	switch(msg.type)
	{

		case "corps" :
			path.position = msg.pos;
			candy.position = msg.poscandy;
			candy.fillColor.hue += 1;
			
			var i = 0;

			if (msg.posqueue.length > elem.length)
			{
				elem.push(new Path.Circle(new Point(0, 0), radius));
			}


			while(i<msg.posqueue.length)
			{
				elem[i].fillColor = 'black';
				elem[i].position = msg.posqueue[i];			
				i++;
			}
		
		case "candy" :
			candy.position = msg.poscandy; 	
	}

};

ws.onclose = function (event) {      
  alert("Perdu (u suck), score : "+elem.length);
};


			</script>
	</head>
	<body>
		<canvas id="myCanvas" width=1200 height=500></canvas>
	</body>
</html>